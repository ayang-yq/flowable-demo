<?xml version="1.0" encoding="UTF-8"?>
<cmmn:definitions xmlns:cmmn="http://www.omg.org/spec/CMMN/20151109/MODEL"
                   xmlns:flowable="http://flowable.org/cmmn"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns:cmmndi="http://www.omg.org/spec/CMMN/20151109/CMMNDI"
                   xmlns:dc="http://www.omg.org/spec/CMMN/20151109/DC"
                   xmlns:di="http://www.omg.org/spec/CMMN/20151109/DI"
                   targetNamespace="http://flowable.org/cmmn">

    <cmmn:case id="insuranceClaimCase" name="Insurance Claim Case" flowable:initiatorVariableName="initiator">
        <cmmn:casePlanModel id="casePlanModel" name="Insurance Claim Plan Model">

            <cmmn:planItem id="planItemStageTriage" name="Triage" definitionRef="stageTriage" />
            <cmmn:planItem id="planItemStageInvestigation" name="Investigation" definitionRef="stageInvestigation">
               <cmmn:entryCriterion id="entrySentryInvestigation" sentryRef="sentryInvestigationEntry" />
            </cmmn:planItem>
            
            <cmmn:planItem id="planItemStageApproval" name="Approval" definitionRef="stageApproval">
                <cmmn:entryCriterion id="entrySentryApproval" sentryRef="sentryApprovalEntry" />
                <cmmn:entryCriterion id="entrySentryApprovalFromInvestigation" sentryRef="sentryApprovalFromInvestigation" />
                <cmmn:exitCriterion id="exitSentryApproval" sentryRef="sentryApprovalExit" />
            </cmmn:planItem>
            
            <cmmn:planItem id="planItemStagePayment" name="Payment" definitionRef="stagePayment">
                <cmmn:entryCriterion id="entrySentryPayment" sentryRef="sentryPaymentEntry" />
            </cmmn:planItem>
            <cmmn:planItem id="planItemStageClosure" name="Closure" definitionRef="stageClosure">
                <cmmn:entryCriterion id="entrySentryClosure" sentryRef="sentryClosureEntry" />
            </cmmn:planItem>
            
            <cmmn:sentry id="sentryAssessComplexityEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskReviewClaim">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
            </cmmn:sentry>
            
            <cmmn:sentry id="sentryInvestigationEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskAssessComplexity">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
                <cmmn:ifPart>
                    <cmmn:condition><![CDATA[${claimComplexity == 'complex'}]]></cmmn:condition>
                </cmmn:ifPart>
            </cmmn:sentry>
            
            <cmmn:sentry id="sentryAssessDamageEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskGatherDocuments">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
            </cmmn:sentry>
            
            <cmmn:sentry id="sentryApprovalEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskAssessComplexity">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
                <cmmn:ifPart>
                    <cmmn:condition><![CDATA[${claimComplexity == 'simple'}]]></cmmn:condition>
                </cmmn:ifPart>
            </cmmn:sentry>
           
            <cmmn:sentry id="sentryApprovalFromInvestigation">
                <cmmn:planItemOnPart sourceRef="planItemStageInvestigation">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
            </cmmn:sentry>

            <cmmn:sentry id="sentryApprovalExit">
                <cmmn:planItemOnPart sourceRef="planItemTaskFinalApproval">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
                <cmmn:ifPart>
                    <cmmn:condition><![CDATA[${approved == false}]]></cmmn:condition>
                </cmmn:ifPart>
            </cmmn:sentry>
 
            <cmmn:sentry id="sentryPaymentEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskFinalApproval">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
                <cmmn:ifPart>
                    <cmmn:condition><![CDATA[${approved == true}]]></cmmn:condition>
                </cmmn:ifPart>
            </cmmn:sentry>
            
            <cmmn:sentry id="sentryClosureEntry">
                <cmmn:planItemOnPart sourceRef="planItemStagePayment">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
            </cmmn:sentry>
            
            <cmmn:sentry id="sentryCaseClosedEntry">
                <cmmn:planItemOnPart sourceRef="planItemTaskNotifyCustomer">
                    <cmmn:standardEvent>complete</cmmn:standardEvent>
                </cmmn:planItemOnPart>
            </cmmn:sentry>

            <cmmn:stage id="stageTriage" name="Triage">
                <cmmn:planItem id="planItemTaskReviewClaim" name="Review Claim Application" definitionRef="taskReviewClaim" />
                <cmmn:planItem id="planItemTaskAssessComplexity" name="Assess Claim Complexity" definitionRef="taskAssessComplexity">
                     <cmmn:entryCriterion id="entrySentryAssessComplexity" sentryRef="sentryAssessComplexityEntry" />
                </cmmn:planItem>
            </cmmn:stage>

            <cmmn:stage id="stageInvestigation" name="Investigation">
                <cmmn:planItem id="planItemTaskGatherDocuments" name="Gather Missing Documents" definitionRef="taskGatherDocuments">
                    <cmmn:itemControl>
                        <cmmn:repetitionRule>
                            <cmmn:condition><![CDATA[${repetitionNeeded}]]></cmmn:condition>
                        </cmmn:repetitionRule>
                    </cmmn:itemControl>
                </cmmn:planItem>
                <cmmn:planItem id="planItemTaskAssessDamage" name="Assess Damages" definitionRef="taskAssessDamage">
                    <cmmn:entryCriterion id="entrySentryAssessDamage" sentryRef="sentryAssessDamageEntry" />
                </cmmn:planItem>
            </cmmn:stage>

            <cmmn:stage id="stageApproval" name="Approval">
                <cmmn:planItem id="planItemTaskFinalApproval" name="Final Claim Approval" definitionRef="taskFinalApproval" />
            </cmmn:stage>

            <cmmn:stage id="stagePayment" name="Payment">
                <cmmn:planItem id="planItemTaskProcessPayment" name="Process Claim Payment" definitionRef="taskProcessPayment" />
            </cmmn:stage>

            <cmmn:stage id="stageClosure" name="Closure">
                <cmmn:planItem id="planItemTaskNotifyCustomer" name="Notify Customer of Outcome" definitionRef="taskNotifyCustomer" />
                <cmmn:planItem id="planItemMilestoneCaseClosed" name="Case Closed" definitionRef="milestoneCaseClosed">
                    <cmmn:entryCriterion id="entrySentryCaseClosed" sentryRef="sentryCaseClosedEntry" />
                </cmmn:planItem>
            </cmmn:stage>

            <cmmn:humanTask id="taskReviewClaim" name="Review Claim Application" flowable:assignee="${claimAdjuster}" />
            <cmmn:decisionTask id="taskAssessComplexity" name="Assess Claim Complexity" decisionRef="ClaimDecisionTable" />
            <cmmn:humanTask id="taskGatherDocuments" name="Gather Missing Documents" flowable:assignee="${claimAdjuster}" />
            <cmmn:humanTask id="taskAssessDamage" name="Assess Damages" flowable:assignee="${damageAssessor}" />
            <cmmn:humanTask id="taskFinalApproval" name="Final Claim Approval" flowable:candidateGroups="${approverGroup}" />
            <cmmn:processTask id="taskProcessPayment" name="Process Claim Payment">
                <cmmn:extensionElements>
                    <flowable:in source="amount" target="amount" />
                    <flowable:in source="reference" target="reference" />
                    <flowable:in source="payeeName" target="payeeName" />
                    <flowable:in source="claimId" target="claimId" />

                    <flowable:in source="paymentOfficer" target="paymentOfficer" />
                    <flowable:in source="paymentManager" target="paymentManager" />

                    <flowable:in source="caseInstanceId" target="caseInstanceId" />
                    
                    <flowable:out source="paymentStatus" target="paymentStatus" />
                </cmmn:extensionElements>
                <cmmn:processRefExpression><![CDATA[ClaimPaymentProcess]]></cmmn:processRefExpression>
            </cmmn:processTask>
            <cmmn:humanTask id="taskNotifyCustomer" name="Notify Customer of Outcome" flowable:assignee="${claimAdjuster}" />
            <cmmn:milestone id="milestoneCaseClosed" name="Case Closed" />

        </cmmn:casePlanModel>
    </cmmn:case>

    <cmmn:decision id="ClaimDecisionTable" name="理赔决策表" externalRef="ClaimDecisionTable" />

    <cmmndi:CMMNDI>
        <cmmndi:CMMNDiagram id="CMMNDiagram_insuranceClaimCase">
            <cmmndi:CMMNShape id="CMMNShape_casePlanModel" cmmnElementRef="casePlanModel">
                <dc:Bounds height="700" width="1000" x="0" y="0" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNShape id="CMMNShape_planItemStageTriage" cmmnElementRef="planItemStageTriage">
                <dc:Bounds height="250" width="250" x="50" y="50" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
             <cmmndi:CMMNShape id="CMMNShape_planItemStageInvestigation" cmmnElementRef="planItemStageInvestigation">
                <dc:Bounds height="250" width="250" x="350" y="50" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemStageApproval" cmmnElementRef="planItemStageApproval">
                <dc:Bounds height="250" width="250" x="650" y="50" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemStagePayment" cmmnElementRef="planItemStagePayment">
                <dc:Bounds height="250" width="250" x="350" y="350" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemStageClosure" cmmnElementRef="planItemStageClosure">
                <dc:Bounds height="250" width="250" x="650" y="350" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskReviewClaim" cmmnElementRef="planItemTaskReviewClaim">
                <dc:Bounds height="80" width="100" x="75" y="80" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskAssessComplexity" cmmnElementRef="planItemTaskAssessComplexity">
                <dc:Bounds height="80" width="100" x="75" y="180" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskGatherDocuments" cmmnElementRef="planItemTaskGatherDocuments">
                <dc:Bounds height="80" width="100" x="375" y="80" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskAssessDamage" cmmnElementRef="planItemTaskAssessDamage">
                <dc:Bounds height="80" width="100" x="375" y="180" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskFinalApproval" cmmnElementRef="planItemTaskFinalApproval">
                <dc:Bounds height="80" width="100" x="675" y="110" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskProcessPayment" cmmnElementRef="planItemTaskProcessPayment">
                <dc:Bounds height="80" width="100" x="375" y="410" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemTaskNotifyCustomer" cmmnElementRef="planItemTaskNotifyCustomer">
                <dc:Bounds height="80" width="100" x="675" y="380" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            <cmmndi:CMMNShape id="CMMNShape_planItemMilestoneCaseClosed" cmmnElementRef="planItemMilestoneCaseClosed">
                <dc:Bounds height="80" width="100" x="675" y="480" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNShape id="CMMNShape_sentryAssessComplexityEntry" cmmnElementRef="entrySentryAssessComplexity">
                <dc:Bounds height="28" width="18" x="116" y="166" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNShape id="CMMNShape_sentryInvestigationEntry" cmmnElementRef="entrySentryInvestigation">
                <dc:Bounds height="28" width="18" x="341" y="161" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryAssessDamageEntry" cmmnElementRef="entrySentryAssessDamage">
                <dc:Bounds height="28" width="18" x="416" y="166" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNShape id="CMMNShape_sentryApprovalEntry" cmmnElementRef="entrySentryApproval">
                <dc:Bounds height="28" width="18" x="641" y="161" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryApprovalFromInvestigation" cmmnElementRef="entrySentryApprovalFromInvestigation">
                <dc:Bounds height="28" width="18" x="641" y="100" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryApprovalExit" cmmnElementRef="exitSentryApproval">
                <dc:Bounds height="28" width="18" x="891" y="161" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryPaymentEntry" cmmnElementRef="entrySentryPayment">
                <dc:Bounds height="28" width="18" x="466" y="336" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryClosureEntry" cmmnElementRef="entrySentryClosure">
                <dc:Bounds height="28" width="18" x="766" y="336" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>

            <cmmndi:CMMNShape id="CMMNShape_sentryCaseClosedEntry" cmmnElementRef="entrySentryCaseClosed">
                <dc:Bounds height="28" width="18" x="716" y="466" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNShape>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryAssessComplexityEntry_taskReviewClaim" sourceCMMNElementRef="planItemTaskReviewClaim" targetCMMNElementRef="entrySentryAssessComplexity">
                <di:waypoint x="125" y="160" />
                <di:waypoint x="125" y="166" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryInvestigationEntry_taskAssessComplexity" sourceCMMNElementRef="planItemTaskAssessComplexity" targetCMMNElementRef="entrySentryInvestigation">
                <di:waypoint x="175" y="220" />
                <di:waypoint x="258" y="220" />
                <di:waypoint x="258" y="175" />
                <di:waypoint x="341" y="175" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryAssessDamageEntry_taskGatherDocuments" sourceCMMNElementRef="planItemTaskGatherDocuments" targetCMMNElementRef="entrySentryAssessDamage">
                <di:waypoint x="425" y="160" />
                <di:waypoint x="425" y="166" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryApprovalEntry_taskAssessComplexity" sourceCMMNElementRef="planItemTaskAssessComplexity" targetCMMNElementRef="entrySentryApproval">
                <di:waypoint x="175" y="220" />
                <di:waypoint x="260" y="220" />
                <di:waypoint x="260" y="320" />
                <di:waypoint x="600" y="320" />
                <di:waypoint x="600" y="175" />
                <di:waypoint x="641" y="175" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryApprovalFromInvestigation_stageInvestigation" sourceCMMNElementRef="planItemStageInvestigation" targetCMMNElementRef="entrySentryApprovalFromInvestigation">
                <di:waypoint x="600" y="175" />
                <di:waypoint x="620" y="175" />
                <di:waypoint x="620" y="114" />
                <di:waypoint x="641" y="114" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>

            <cmmndi:CMMNEdge id="CMMNEdge_sentryApprovalExit_taskFinalApproval" sourceCMMNElementRef="planItemTaskFinalApproval" targetCMMNElementRef="exitSentryApproval">
                <di:waypoint x="775" y="150" />
                <di:waypoint x="830" y="150" />
                <di:waypoint x="830" y="175" />
                <di:waypoint x="891" y="175" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryPaymentEntry_taskFinalApproval" sourceCMMNElementRef="planItemTaskFinalApproval" targetCMMNElementRef="entrySentryPayment">
                <di:waypoint x="775" y="150" />
                <di:waypoint x="800" y="150" />
                <di:waypoint x="800" y="310" />
                <di:waypoint x="475" y="310" />
                <di:waypoint x="475" y="336" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryClosureEntry_stagePayment" sourceCMMNElementRef="planItemStagePayment" targetCMMNElementRef="entrySentryClosure">
                <di:waypoint x="600" y="475" />
                <di:waypoint x="625" y="475" />
                <di:waypoint x="625" y="300" />
                <di:waypoint x="775" y="300" />
                <di:waypoint x="775" y="336" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>
            
            <cmmndi:CMMNEdge id="CMMNEdge_sentryCaseClosedEntry_taskNotifyCustomer" sourceCMMNElementRef="planItemTaskNotifyCustomer" targetCMMNElementRef="entrySentryCaseClosed">
                <di:waypoint x="725" y="460" />
                <di:waypoint x="725" y="466" />
                <cmmndi:CMMNLabel />
            </cmmndi:CMMNEdge>

        </cmmndi:CMMNDiagram>
    </cmmndi:CMMNDI>

</cmmn:definitions>